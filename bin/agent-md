#!/bin/bash
# SPDX-License-Identifier: GPL-3.0-or-later

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "$(readlink -f "${BASH_SOURCE[0]}")")" && pwd)"
REPO_DIR="$(cd "$SCRIPT_DIR/.." && pwd)"

stash_files=()

while [[ $# -gt 0 ]]; do
    case "$1" in
        -s|--stash)
            shift
            while [[ $# -gt 0 ]] && [[ "$1" != -* ]]; do
                stash_files+=("$1")
                shift
            done
            ;;
        *)
            echo "Unknown option: $1"
            exit 1
            ;;
    esac
done

if [[ ${#stash_files[@]} -gt 0 ]]; then
    "$REPO_DIR/lib/stash" "$REPO_DIR" "${stash_files[@]}"
else
    "$SCRIPT_DIR/claude-md"
    "$SCRIPT_DIR/codex-md"
fi
